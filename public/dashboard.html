<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeamPulse Mindguard AI для OpsLab - Dashboard</title>
    <link rel="stylesheet" href="/css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1 class="header-title">TeamPulse Mindguard AI для OpsLab</h1>
            <nav class="header-nav">
                <button class="logout-btn" onclick="handleLogout()">Вийти</button>
            </nav>
        </header>

        <!-- Month Selector -->
        <div class="month-selector">
            <button class="month-btn" data-month="8" onclick="selectMonth(8)">Серпень</button>
            <button class="month-btn" data-month="9" onclick="selectMonth(9)">Вересень</button>
            <button class="month-btn active" data-month="10" onclick="selectMonth(10)">Жовтень</button>
            <button class="month-btn" data-month="11" onclick="selectMonth(11)">Листопад</button>
        </div>

        <!-- Metrics Section -->
        <section class="metrics-section">
            <h2 class="section-title">Ключові показники команди</h2>
            <div class="metrics-grid">
                <!-- WHO-5 Well-Being Index -->
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-label-wrapper">
                            <span class="metric-label">WHO-5 Благополуччя</span>
                            <span class="info-icon" data-tooltip="Індекс благополуччя ВООЗ (0-100). Оцінює позитивне психічне здоров'я за 5 питаннями. <50 - низьке благополуччя, потребує уваги.">i</span>
                        </div>
                    </div>
                    <div class="metric-value" id="who5-value">--</div>
                    <div class="metric-description">Середній показник</div>
                    <span class="risk-indicator" id="who5-risk">Завантаження...</span>
                </div>

                <!-- PHQ-9 Depression -->
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-label-wrapper">
                            <span class="metric-label">PHQ-9 Депресія</span>
                            <span class="info-icon" data-tooltip="Опитувальник здоров'я пацієнта (0-27). Вимірює тяжкість депресії. 0-4: мінімальна, 5-9: легка, 10-14: помірна, 15+: тяжка депресія.">i</span>
                        </div>
                    </div>
                    <div class="metric-value" id="phq9-value">--</div>
                    <div class="metric-description">Середній показник</div>
                    <span class="risk-indicator" id="phq9-risk">Завантаження...</span>
                </div>

                <!-- GAD-7 Anxiety -->
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-label-wrapper">
                            <span class="metric-label">GAD-7 Тривожність</span>
                            <span class="info-icon" data-tooltip="Шкала генералізованої тривожності (0-21). 0-4: мінімальна, 5-9: легка, 10-14: помірна, 15+: тяжка тривожність.">i</span>
                        </div>
                    </div>
                    <div class="metric-value" id="gad7-value">--</div>
                    <div class="metric-description">Середній показник</div>
                    <span class="risk-indicator" id="gad7-risk">Завантаження...</span>
                </div>

                <!-- MBI Burnout -->
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-label-wrapper">
                            <span class="metric-label">MBI Вигорання</span>
                            <span class="info-icon" data-tooltip="Опитувальник вигорання Маслач (0-100%). Вимірює емоційне виснаження. <25%: низький ризик, 25-50%: середній, >50%: високий ризик вигорання.">i</span>
                        </div>
                    </div>
                    <div class="metric-value" id="mbi-value">--</div>
                    <div class="metric-description">Середній показник (%)</div>
                    <span class="risk-indicator" id="mbi-risk">Завантаження...</span>
                </div>

                <!-- Sleep Duration -->
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-label-wrapper">
                            <span class="metric-label">Тривалість сну</span>
                            <span class="info-icon" data-tooltip="Середня тривалість сну (години). Рекомендовано 7-9 годин для дорослих. Менше 6 год - недостатній сон.">i</span>
                        </div>
                    </div>
                    <div class="metric-value" id="sleep-duration-value">--</div>
                    <div class="metric-description">Середня кількість годин</div>
                    <span class="risk-indicator" id="sleep-duration-risk">Завантаження...</span>
                </div>

                <!-- Sleep Quality -->
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-label-wrapper">
                            <span class="metric-label">Якість сну</span>
                            <span class="info-icon" data-tooltip="Самооцінка якості сну (1-10). 7-10: хороша якість, 4-6: задовільна, <4: погана якість сну.">i</span>
                        </div>
                    </div>
                    <div class="metric-value" id="sleep-quality-value">--</div>
                    <div class="metric-description">Середня оцінка (1-10)</div>
                    <span class="risk-indicator" id="sleep-quality-risk">Завантаження...</span>
                </div>

                <!-- Work-Life Balance -->
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-label-wrapper">
                            <span class="metric-label">Баланс життя</span>
                            <span class="info-icon" data-tooltip="Баланс між роботою та особистим життям (1-10). 7-10: здоровий баланс, 4-6: потребує покращення, <4: критичний дисбаланс.">i</span>
                        </div>
                    </div>
                    <div class="metric-value" id="work-life-value">--</div>
                    <div class="metric-description">Середня оцінка (1-10)</div>
                    <span class="risk-indicator" id="work-life-risk">Завантаження...</span>
                </div>

                <!-- Stress Level -->
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-label-wrapper">
                            <span class="metric-label">Рівень стресу</span>
                            <span class="info-icon" data-tooltip="Рівень стресу за шкалою PSS (0-40). 0-13: низький, 14-26: помірний, 27-40: високий рівень стресу.">i</span>
                        </div>
                    </div>
                    <div class="metric-value" id="stress-value">--</div>
                    <div class="metric-description">Середній показник (0-40)</div>
                    <span class="risk-indicator" id="stress-risk">Завантаження...</span>
                </div>
            </div>
        </section>

        <!-- Charts Section -->
        <section class="charts-section">
            <h2 class="section-title">Аналітика показників</h2>
            <div class="charts-grid">
                <div class="chart-card">
                    <h3 class="chart-title">Динаміка психічного здоров'я</h3>
                    <canvas id="mentalHealthChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Показники сну</h3>
                    <canvas id="sleepChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Розподіл ризиків вигорання</h3>
                    <canvas id="burnoutDistributionChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Стрес та баланс життя</h3>
                    <canvas id="stressBalanceChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Employee Analysis Table -->
        <section class="table-section">
            <h2 class="section-title">Аналіз працівників</h2>
            <div class="table-container">
                <table id="employee-table">
                    <thead>
                        <tr>
                            <th>Співробітник</th>
                            <th>WHO-5</th>
                            <th>PHQ-9</th>
                            <th>GAD-7</th>
                            <th>MBI (%)</th>
                            <th>Сон (год)</th>
                            <th>Якість сну</th>
                            <th>Баланс</th>
                            <th>Стрес</th>
                            <th>Загальний ризик</th>
                        </tr>
                    </thead>
                    <tbody id="employee-table-body">
                        <tr>
                            <td colspan="10" style="text-align: center; padding: 2rem;">Завантаження даних...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Risk Assessment Section -->
        <section class="risk-assessment">
            <h2 class="section-title">Оцінка ризиків</h2>
            <div class="risk-items" id="risk-items">
                <div class="risk-item medium">
                    <div class="risk-item-title">Завантаження даних...</div>
                    <div class="risk-item-description">Зачекайте, будь ласка</div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <p>&copy; 2024 TeamPulse Mindguard AI. Всі права захищені.</p>
        </footer>
    </div>

    <script>
        // Global variables
        let currentMonth = 10; // October by default
        let teamData = null;
        let charts = {};

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });

        // Load data from API
        async function loadData() {
            try {
                const response = await fetch('/api/team-data');
                if (!response.ok) {
                    throw new Error('Failed to fetch data');
                }
                teamData = await response.json();
                updateDashboard();
            } catch (error) {
                console.error('Error loading data:', error);
                showError('Помилка завантаження даних. Будь ласка, спробуйте пізніше.');
            }
        }

        // Month selector
        function selectMonth(month) {
            currentMonth = month;

            // Update active button
            document.querySelectorAll('.month-btn').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.dataset.month) === month) {
                    btn.classList.add('active');
                }
            });

            updateDashboard();
        }

        // Update dashboard with current month data
        function updateDashboard() {
            if (!teamData) return;

            const monthData = getMonthData();
            updateMetrics(monthData);
            updateCharts(monthData);
            updateEmployeeTable(monthData);
            updateRiskAssessment(monthData);
        }

        // Get data for selected month
        function getMonthData() {
            if (!teamData || !teamData.months) return null;
            return teamData.months.find(m => m.month === currentMonth) || teamData.months[0];
        }

        // Update metrics cards
        function updateMetrics(data) {
            if (!data || !data.averages) return;

            const avg = data.averages;

            // WHO-5 Well-Being Index
            document.getElementById('who5-value').textContent = avg.who5.toFixed(1);
            updateRiskIndicator('who5-risk', getRiskLevel('who5', avg.who5));

            // PHQ-9 Depression
            document.getElementById('phq9-value').textContent = avg.phq9.toFixed(1);
            updateRiskIndicator('phq9-risk', getRiskLevel('phq9', avg.phq9));

            // GAD-7 Anxiety
            document.getElementById('gad7-value').textContent = avg.gad7.toFixed(1);
            updateRiskIndicator('gad7-risk', getRiskLevel('gad7', avg.gad7));

            // MBI Burnout
            document.getElementById('mbi-value').textContent = avg.mbi.toFixed(1) + '%';
            updateRiskIndicator('mbi-risk', getRiskLevel('mbi', avg.mbi));

            // Sleep Duration
            document.getElementById('sleep-duration-value').textContent = avg.sleepDuration.toFixed(1) + ' год';
            updateRiskIndicator('sleep-duration-risk', getRiskLevel('sleepDuration', avg.sleepDuration));

            // Sleep Quality
            document.getElementById('sleep-quality-value').textContent = avg.sleepQuality.toFixed(1);
            updateRiskIndicator('sleep-quality-risk', getRiskLevel('sleepQuality', avg.sleepQuality));

            // Work-Life Balance
            document.getElementById('work-life-value').textContent = avg.workLifeBalance.toFixed(1);
            updateRiskIndicator('work-life-risk', getRiskLevel('workLifeBalance', avg.workLifeBalance));

            // Stress Level
            document.getElementById('stress-value').textContent = avg.stressLevel.toFixed(1);
            updateRiskIndicator('stress-risk', getRiskLevel('stressLevel', avg.stressLevel));
        }

        // Get risk level based on metric
        function getRiskLevel(metric, value) {
            const thresholds = {
                who5: { low: 50, medium: 75 }, // Lower is worse
                phq9: { low: 5, medium: 10 }, // Higher is worse
                gad7: { low: 5, medium: 10 }, // Higher is worse
                mbi: { low: 25, medium: 50 }, // Higher is worse
                sleepDuration: { low: 6, medium: 7 }, // Lower is worse
                sleepQuality: { low: 4, medium: 7 }, // Lower is worse
                workLifeBalance: { low: 4, medium: 7 }, // Lower is worse
                stressLevel: { low: 14, medium: 27 } // Higher is worse
            };

            const t = thresholds[metric];

            // Metrics where lower is worse
            if (['who5', 'sleepDuration', 'sleepQuality', 'workLifeBalance'].includes(metric)) {
                if (value >= t.medium) return 'low';
                if (value >= t.low) return 'medium';
                return 'high';
            }

            // Metrics where higher is worse
            if (value < t.low) return 'low';
            if (value < t.medium) return 'medium';
            return 'high';
        }

        // Update risk indicator element
        function updateRiskIndicator(elementId, riskLevel) {
            const element = document.getElementById(elementId);
            const labels = {
                low: 'Низький ризик',
                medium: 'Середній ризик',
                high: 'Високий ризик'
            };

            element.textContent = labels[riskLevel];
            element.className = 'risk-indicator risk-' + riskLevel;
        }

        // Update charts
        function updateCharts(data) {
            if (!data || !data.employees) return;

            updateMentalHealthChart(data);
            updateSleepChart(data);
            updateBurnoutDistributionChart(data);
            updateStressBalanceChart(data);
        }

        // Mental Health Chart
        function updateMentalHealthChart(data) {
            const ctx = document.getElementById('mentalHealthChart').getContext('2d');

            if (charts.mentalHealth) {
                charts.mentalHealth.destroy();
            }

            charts.mentalHealth = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.employees.map(e => e.name),
                    datasets: [
                        {
                            label: 'WHO-5 Благополуччя',
                            data: data.employees.map(e => e.who5),
                            borderColor: '#22c55e',
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'PHQ-9 Депресія (інверс.)',
                            data: data.employees.map(e => 27 - e.phq9), // Invert for better visualization
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(251, 191, 36, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'GAD-7 Тривожність (інверс.)',
                            data: data.employees.map(e => 21 - e.gad7), // Invert for better visualization
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e2e8f0'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(99, 102, 241, 0.1)'
                            },
                            ticks: {
                                color: '#cbd5e1'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(99, 102, 241, 0.1)'
                            },
                            ticks: {
                                color: '#cbd5e1'
                            }
                        }
                    }
                }
            });
        }

        // Sleep Chart
        function updateSleepChart(data) {
            const ctx = document.getElementById('sleepChart').getContext('2d');

            if (charts.sleep) {
                charts.sleep.destroy();
            }

            charts.sleep = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.employees.map(e => e.name),
                    datasets: [
                        {
                            label: 'Тривалість сну (год)',
                            data: data.employees.map(e => e.sleepDuration),
                            backgroundColor: '#6366f1',
                            yAxisID: 'y'
                        },
                        {
                            label: 'Якість сну (1-10)',
                            data: data.employees.map(e => e.sleepQuality),
                            backgroundColor: '#8b5cf6',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e2e8f0'
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            position: 'left',
                            beginAtZero: true,
                            max: 12,
                            title: {
                                display: true,
                                text: 'Години',
                                color: '#cbd5e1'
                            },
                            grid: {
                                color: 'rgba(99, 102, 241, 0.1)'
                            },
                            ticks: {
                                color: '#cbd5e1'
                            }
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            beginAtZero: true,
                            max: 10,
                            title: {
                                display: true,
                                text: 'Якість (1-10)',
                                color: '#cbd5e1'
                            },
                            grid: {
                                drawOnChartArea: false
                            },
                            ticks: {
                                color: '#cbd5e1'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(99, 102, 241, 0.1)'
                            },
                            ticks: {
                                color: '#cbd5e1'
                            }
                        }
                    }
                }
            });
        }

        // Burnout Distribution Chart
        function updateBurnoutDistributionChart(data) {
            const ctx = document.getElementById('burnoutDistributionChart').getContext('2d');

            if (charts.burnout) {
                charts.burnout.destroy();
            }

            // Count employees by burnout risk level
            const counts = { low: 0, medium: 0, high: 0 };
            data.employees.forEach(e => {
                const risk = getRiskLevel('mbi', e.mbi);
                counts[risk]++;
            });

            charts.burnout = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Низький ризик', 'Середній ризик', 'Високий ризик'],
                    datasets: [{
                        data: [counts.low, counts.medium, counts.high],
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(251, 191, 36, 0.8)',
                            'rgba(239, 68, 68, 0.8)'
                        ],
                        borderColor: [
                            '#22c55e',
                            '#fbbf24',
                            '#ef4444'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#e2e8f0',
                                padding: 15
                            }
                        }
                    }
                }
            });
        }

        // Stress and Balance Chart
        function updateStressBalanceChart(data) {
            const ctx = document.getElementById('stressBalanceChart').getContext('2d');

            if (charts.stressBalance) {
                charts.stressBalance.destroy();
            }

            charts.stressBalance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: data.employees.map(e => e.name),
                    datasets: [
                        {
                            label: 'Баланс життя (1-10)',
                            data: data.employees.map(e => e.workLifeBalance),
                            borderColor: '#22c55e',
                            backgroundColor: 'rgba(34, 197, 94, 0.2)',
                            pointBackgroundColor: '#22c55e'
                        },
                        {
                            label: 'Стрес (інверс., 0-40)',
                            data: data.employees.map(e => (40 - e.stressLevel) / 4), // Normalize and invert
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.2)',
                            pointBackgroundColor: '#ef4444'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e2e8f0'
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            grid: {
                                color: 'rgba(99, 102, 241, 0.2)'
                            },
                            ticks: {
                                color: '#cbd5e1',
                                backdropColor: 'transparent'
                            },
                            pointLabels: {
                                color: '#cbd5e1',
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update employee table
        function updateEmployeeTable(data) {
            if (!data || !data.employees) return;

            const tbody = document.getElementById('employee-table-body');
            tbody.innerHTML = '';

            data.employees.forEach(emp => {
                const row = document.createElement('tr');

                // Calculate overall risk
                const risks = [
                    getRiskLevel('who5', emp.who5),
                    getRiskLevel('phq9', emp.phq9),
                    getRiskLevel('gad7', emp.gad7),
                    getRiskLevel('mbi', emp.mbi),
                    getRiskLevel('sleepDuration', emp.sleepDuration),
                    getRiskLevel('sleepQuality', emp.sleepQuality),
                    getRiskLevel('workLifeBalance', emp.workLifeBalance),
                    getRiskLevel('stressLevel', emp.stressLevel)
                ];

                const highCount = risks.filter(r => r === 'high').length;
                const mediumCount = risks.filter(r => r === 'medium').length;

                let overallRisk = 'low';
                if (highCount >= 3 || (highCount >= 2 && mediumCount >= 3)) {
                    overallRisk = 'high';
                } else if (highCount >= 1 || mediumCount >= 3) {
                    overallRisk = 'medium';
                }

                row.innerHTML = `
                    <td class="employee-name">${emp.name}</td>
                    <td class="score-cell ${getScoreClass('who5', emp.who5)}">${emp.who5.toFixed(1)}</td>
                    <td class="score-cell ${getScoreClass('phq9', emp.phq9)}">${emp.phq9.toFixed(1)}</td>
                    <td class="score-cell ${getScoreClass('gad7', emp.gad7)}">${emp.gad7.toFixed(1)}</td>
                    <td class="score-cell ${getScoreClass('mbi', emp.mbi)}">${emp.mbi.toFixed(1)}%</td>
                    <td class="score-cell ${getScoreClass('sleepDuration', emp.sleepDuration)}">${emp.sleepDuration.toFixed(1)}</td>
                    <td class="score-cell ${getScoreClass('sleepQuality', emp.sleepQuality)}">${emp.sleepQuality.toFixed(1)}</td>
                    <td class="score-cell ${getScoreClass('workLifeBalance', emp.workLifeBalance)}">${emp.workLifeBalance.toFixed(1)}</td>
                    <td class="score-cell ${getScoreClass('stressLevel', emp.stressLevel)}">${emp.stressLevel.toFixed(1)}</td>
                    <td class="score-cell"><span class="risk-indicator risk-${overallRisk}">${getRiskLabel(overallRisk)}</span></td>
                `;

                tbody.appendChild(row);
            });
        }

        // Get score class for table cells
        function getScoreClass(metric, value) {
            const risk = getRiskLevel(metric, value);
            if (risk === 'low') return 'score-good';
            if (risk === 'medium') return 'score-warning';
            return 'score-danger';
        }

        // Get risk label
        function getRiskLabel(risk) {
            const labels = {
                low: 'Низький',
                medium: 'Середній',
                high: 'Високий'
            };
            return labels[risk] || 'Невідомо';
        }

        // Update risk assessment
        function updateRiskAssessment(data) {
            if (!data || !data.employees) return;

            const container = document.getElementById('risk-items');
            container.innerHTML = '';

            const risks = [];

            // Analyze each metric
            const avg = data.averages;

            // WHO-5
            if (avg.who5 < 50) {
                risks.push({
                    level: 'high',
                    title: 'Критично низький рівень благополуччя',
                    description: `Середній показник WHO-5: ${avg.who5.toFixed(1)}. Команда потребує термінової підтримки психічного здоров'я.`
                });
            } else if (avg.who5 < 75) {
                risks.push({
                    level: 'medium',
                    title: 'Знижений рівень благополуччя',
                    description: `Середній показник WHO-5: ${avg.who5.toFixed(1)}. Рекомендується моніторинг та профілактичні заходи.`
                });
            }

            // PHQ-9
            if (avg.phq9 >= 10) {
                risks.push({
                    level: 'high',
                    title: 'Підвищений рівень депресії',
                    description: `Середній показник PHQ-9: ${avg.phq9.toFixed(1)}. Потрібна консультація спеціалістів.`
                });
            } else if (avg.phq9 >= 5) {
                risks.push({
                    level: 'medium',
                    title: 'Помірні ознаки депресії',
                    description: `Середній показник PHQ-9: ${avg.phq9.toFixed(1)}. Слід звернути увагу на емоційний стан команди.`
                });
            }

            // GAD-7
            if (avg.gad7 >= 10) {
                risks.push({
                    level: 'high',
                    title: 'Високий рівень тривожності',
                    description: `Середній показник GAD-7: ${avg.gad7.toFixed(1)}. Необхідні заходи зі зниження тривожності.`
                });
            } else if (avg.gad7 >= 5) {
                risks.push({
                    level: 'medium',
                    title: 'Підвищена тривожність',
                    description: `Середній показник GAD-7: ${avg.gad7.toFixed(1)}. Рекомендуються релаксаційні практики.`
                });
            }

            // MBI
            if (avg.mbi >= 50) {
                risks.push({
                    level: 'high',
                    title: 'Високий ризик вигорання',
                    description: `Середній показник MBI: ${avg.mbi.toFixed(1)}%. Критичний рівень емоційного виснаження.`
                });
            } else if (avg.mbi >= 25) {
                risks.push({
                    level: 'medium',
                    title: 'Середній ризик вигорання',
                    description: `Середній показник MBI: ${avg.mbi.toFixed(1)}%. Потрібні превентивні заходи.`
                });
            }

            // Sleep Duration
            if (avg.sleepDuration < 6) {
                risks.push({
                    level: 'high',
                    title: 'Недостатня тривалість сну',
                    description: `Середня тривалість сну: ${avg.sleepDuration.toFixed(1)} год. Команда не висипається.`
                });
            } else if (avg.sleepDuration < 7) {
                risks.push({
                    level: 'medium',
                    title: 'Знижена тривалість сну',
                    description: `Середня тривалість сну: ${avg.sleepDuration.toFixed(1)} год. Рекомендується покращення режиму.`
                });
            }

            // Sleep Quality
            if (avg.sleepQuality < 4) {
                risks.push({
                    level: 'high',
                    title: 'Погана якість сну',
                    description: `Середня якість сну: ${avg.sleepQuality.toFixed(1)}. Необхідна консультація щодо гігієни сну.`
                });
            } else if (avg.sleepQuality < 7) {
                risks.push({
                    level: 'medium',
                    title: 'Задовільна якість сну',
                    description: `Середня якість сну: ${avg.sleepQuality.toFixed(1)}. Можна покращити.`
                });
            }

            // Work-Life Balance
            if (avg.workLifeBalance < 4) {
                risks.push({
                    level: 'high',
                    title: 'Критичний дисбаланс життя',
                    description: `Середній баланс: ${avg.workLifeBalance.toFixed(1)}. Робота сильно впливає на особисте життя.`
                });
            } else if (avg.workLifeBalance < 7) {
                risks.push({
                    level: 'medium',
                    title: 'Потребує покращення балансу',
                    description: `Середній баланс: ${avg.workLifeBalance.toFixed(1)}. Рекомендується оптимізація робочого навантаження.`
                });
            }

            // Stress Level
            if (avg.stressLevel >= 27) {
                risks.push({
                    level: 'high',
                    title: 'Високий рівень стресу',
                    description: `Середній рівень стресу: ${avg.stressLevel.toFixed(1)}. Потрібні антистресові заходи.`
                });
            } else if (avg.stressLevel >= 14) {
                risks.push({
                    level: 'medium',
                    title: 'Помірний рівень стресу',
                    description: `Середній рівень стресу: ${avg.stressLevel.toFixed(1)}. Рекомендується моніторинг.`
                });
            }

            // If no risks, show positive message
            if (risks.length === 0) {
                risks.push({
                    level: 'low',
                    title: 'Команда в хорошому стані',
                    description: 'Всі показники в межах норми. Продовжуйте підтримувати здоровий робочий баланс.'
                });
            }

            // Sort risks by level (high -> medium -> low)
            risks.sort((a, b) => {
                const order = { high: 0, medium: 1, low: 2 };
                return order[a.level] - order[b.level];
            });

            // Render risks
            risks.forEach(risk => {
                const item = document.createElement('div');
                item.className = `risk-item ${risk.level}`;
                item.innerHTML = `
                    <div class="risk-item-title">${risk.title}</div>
                    <div class="risk-item-description">${risk.description}</div>
                `;
                container.appendChild(item);
            });
        }

        // Logout handler
        function handleLogout() {
            if (confirm('Ви впевнені, що хочете вийти?')) {
                window.location.href = '/';
            }
        }

        // Error handling
        function showError(message) {
            const container = document.querySelector('.container');
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                background: rgba(239, 68, 68, 0.2);
                border: 1px solid rgba(239, 68, 68, 0.3);
                color: #fca5a5;
                padding: 1rem;
                border-radius: 8px;
                margin-bottom: 1.5rem;
                text-align: center;
            `;
            errorDiv.textContent = message;
            container.insertBefore(errorDiv, container.firstChild);
        }
    </script>
</body>
</html>
